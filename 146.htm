<html>

<head>
  <title> 第26章 调用C函数 - Lua程序设计</title>
  <meta http-equiv=Content-Type content="text/html; charset=UTF-8">
  <meta name="GENERATOR" content="Macrobject Word-2-CHM">
  <link rel="stylesheet" href="Word2Chm.css" type="text/css">
  <link rel="stylesheet" href="default.css" type="text/css" />
</head>

<body lang=ZH-CN link=blue vlink=purple style='text-justify-trim:punctuation'>
  <table width="100%" cellpadding="0" cellspacing="0" border="0">
    <tr>
      <td class="moHeader">&nbsp;第26章 调用C函数</td>
    </tr>
  </table>
  
  <p></p>

<div class=Section1 style='layout-grid:15.6pt'>



<p class=MsoNormal style='text-indent:21.0pt'><span style='font-family:宋体'>扩展</span><span
lang=EN-US>Lua</span><span style='font-family:宋体'>的基本方法之一就是为应用程序注册新的</span><span
lang=EN-US>C</span><span style='font-family:宋体'>函数到</span><span lang=EN-US>Lua</span><span
style='font-family:宋体'>中去。</span></p>

<p class=MsoNormal style='text-indent:21.0pt'><span style='font-family:宋体'>当我们提到</span><span
lang=EN-US>Lua</span><span style='font-family:宋体'>可以调用</span><span lang=EN-US>C</span><span
style='font-family:宋体'>函数，不是指</span><span lang=EN-US>Lua</span><span
style='font-family:宋体'>可以调用任何类型的</span><span lang=EN-US>C</span><span
style='font-family:宋体'>函数（有一些包可以让</span><span lang=EN-US>Lua</span><span
style='font-family:宋体'>调用任意的</span><span lang=EN-US>C</span><span
style='font-family:宋体'>函数，但缺乏便捷和健壮性）。正如我们前面所看到的，当</span><span lang=EN-US>C</span><span
style='font-family:宋体'>调用</span><span lang=EN-US>Lua</span><span
style='font-family:宋体'>函数的时候，必须遵循一些简单的协议来传递参数和获取返回结果。相似的，从</span><span
lang=EN-US>Lua</span><span style='font-family:宋体'>中调用</span><span lang=EN-US>C</span><span
style='font-family:宋体'>函数，也必须遵循一些协议来传递参数和获得返回结果。另外，从</span><span lang=EN-US>Lua</span><span
style='font-family:宋体'>调用</span><span lang=EN-US>C</span><span
style='font-family:宋体'>函数我们必须注册函数，也就是说，我们必须把</span><span lang=EN-US>C</span><span
style='font-family:宋体'>函数的地址以一个适当的方式传递给</span><span lang=EN-US>Lua</span><span
style='font-family:宋体'>解释器。</span></p>

<p class=MsoNormal style='text-indent:21.0pt'><span style='font-family:宋体'>当</span><span
lang=EN-US>Lua</span><span style='font-family:宋体'>调用</span><span lang=EN-US>C</span><span
style='font-family:宋体'>函数的时候，使用和</span><span lang=EN-US>C</span><span
style='font-family:宋体'>调用</span><span lang=EN-US>Lua</span><span
style='font-family:宋体'>相同类型的栈来交互。</span><span lang=EN-US>C</span><span
style='font-family:宋体'>函数从栈中获取她的参数，调用结束后将返回结果放到栈中。为了区分返回结果和栈中的其他的值，每个</span><span
lang=EN-US>C</span><span style='font-family:宋体'>函数还会返回结果的个数（</span><span
lang=EN-US>the function returns (in C) the number of results it is leaving on
the stack.</span><span style='font-family:宋体'>）。这儿有一个重要的概念：用来交互的栈不是全局变量，每一个函数都有他自己的私有栈。当</span><span
lang=EN-US>Lua</span><span style='font-family:宋体'>调用</span><span lang=EN-US>C</span><span
style='font-family:宋体'>函数的时候，第一个参数总是在这个私有栈的</span><span lang=EN-US>index=1</span><span
style='font-family:宋体'>的位置。甚至当一个</span><span lang=EN-US>C</span><span
style='font-family:宋体'>函数调用</span><span lang=EN-US>Lua</span><span
style='font-family:宋体'>代码（</span><span lang=EN-US>Lua</span><span
style='font-family:宋体'>代码调用同一个</span><span lang=EN-US>C</span><span
style='font-family:宋体'>函数或者其他的</span><span lang=EN-US>C</span><span
style='font-family:宋体'>函数），每一个</span><span lang=EN-US>C</span><span
style='font-family:宋体'>函数都有自己的独立的私有栈，并且第一个参数在</span><span lang=EN-US>index=1</span><span
style='font-family:宋体'>的位置。</span></p>


</div>
  <p></p>
  <hr class="moHR" />
  <span class="moCopyright">
    相关链接：
<br /><a href=3.htm>lua程序设计目录</a> - <a href="http://www.luaer.cn">中国lua开发者</a> - <a href="http://bbs.luaer.cn">lua论坛</a> 
  </span><div id="bookfoot"></div>
<script language="JavaScript" src="js/ad.js"></script>
</body>

</html>

