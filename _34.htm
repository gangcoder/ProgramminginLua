<html>

<head>
  <title>4.3 控制结构语句 - Lua程序设计</title>
  <meta http-equiv=Content-Type content="text/html; charset=UTF-8">
  <meta name="GENERATOR" content="Macrobject Word-2-CHM">
  <link rel="stylesheet" href="Word2Chm.css" type="text/css">
  <link rel="stylesheet" href="default.css" type="text/css" />
</head>

<body lang=ZH-CN link=blue vlink=purple style='text-justify-trim:punctuation'>
  <table width="100%" cellpadding="0" cellspacing="0" border="0">
    <tr>
      <td class="moHeader">&nbsp;4.3 控制结构语句</td>
    </tr>
  </table>
  
  <p></p>

<div class=Section1 style='layout-grid:15.6pt'>



<p class=MsoNormal style='text-indent:21.0pt'><span style='font-family:宋体'>控制结构的条件表达式结果可以是任何值，</span><span
lang=EN-US>Lua</span><span style='font-family:宋体'>认为</span><span lang=EN-US>false</span><span
style='font-family:宋体'>和</span><span lang=EN-US>nil</span><span
style='font-family:宋体'>为假，其他值为真。</span></p>

<p class=MsoNormal style='text-indent:21.0pt'><span lang=EN-US>if</span><span
style='font-family:宋体'>语句，有三种形式：</span></p>

<div style='border:RGB(191,154,43) dashed 1px;padding:1.0pt 4.0pt 1.0pt 4.0pt;
background:#fff;margin-left:21.0pt;margin-right:21.0pt'>

<p class=AltD style='margin:0cm;margin-bottom:.0001pt;background:RGB(225,250,227)'><span
lang=EN-US style='color:blue'>if</span><span lang=EN-US> conditions <span
style='color:blue'>then</span> </span></p>

<p class=AltD style='margin:0cm;margin-bottom:.0001pt;background:#fff'><span
lang=EN-US>&nbsp;&nbsp;&nbsp; then-part</span></p>

<p class=AltD style='margin:0cm;margin-bottom:.0001pt;background:RGB(237,244,226)'><span
lang=EN-US style='color:blue'>end</span><span lang=EN-US>;</span></p>

<p class=AltD style='margin:0cm;margin-bottom:.0001pt;background:#fff'><span
lang=EN-US>&nbsp;</span></p>

<p class=AltD style='margin:0cm;margin-bottom:.0001pt;background:RGB(255,222,245)'><span
lang=EN-US style='color:blue'>if</span><span lang=EN-US> conditions <span
style='color:blue'>then</span> </span></p>

<p class=AltD style='margin:0cm;margin-bottom:.0001pt;background:#fff'><span
lang=EN-US>&nbsp;&nbsp;&nbsp; then-part</span></p>

<p class=AltD style='margin:0cm;margin-bottom:.0001pt;background:RGB(223,235,253)'><span
lang=EN-US style='color:blue'>else</span></p>

<p class=AltD style='margin:0cm;margin-bottom:.0001pt;background:#fff'><span
lang=EN-US>&nbsp;&nbsp;&nbsp; else-part</span></p>

<p class=AltD style='margin:0cm;margin-bottom:.0001pt;background:RGB(236,236,238)'><span
lang=EN-US style='color:blue'>end</span><span lang=EN-US>;</span></p>

<p class=AltD style='margin:0cm;margin-bottom:.0001pt;background:#fff'><span
lang=EN-US>&nbsp;</span></p>

<p class=AltD style='margin:0cm;margin-bottom:.0001pt;background:RGB(245,241,240)'><span
lang=EN-US style='color:blue'>if</span><span lang=EN-US> conditions <span
style='color:blue'>then</span> </span></p>

<p class=AltD style='margin:0cm;margin-bottom:.0001pt;background:#fff'><span
lang=EN-US>&nbsp;&nbsp;&nbsp; then-part</span></p>

<p class=AltD style='margin:0cm;margin-bottom:.0001pt;background:RGB(243,238,233)'><span
lang=EN-US style='color:blue'>elseif</span><span lang=EN-US> conditions <span
style='color:blue'>then</span></span></p>

<p class=AltD style='margin:0cm;margin-bottom:.0001pt;background:#fff'><span
lang=EN-US>&nbsp;&nbsp;&nbsp; elseif-part</span></p>

<p class=AltD style='margin:0cm;margin-bottom:.0001pt;background:RGB(231,251,252)'><span
lang=EN-US>..&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span
style='color:green'>---&gt;</span></span><span style='font-family:宋体;
color:green'>多个</span><span lang=EN-US style='color:green'>elseif</span></p>

<p class=AltD style='margin:0cm;margin-bottom:.0001pt;background:#fff'><span
lang=EN-US style='color:blue'>else</span></p>

<p class=AltD style='margin:0cm;margin-bottom:.0001pt;background:RGB(238,220,242)'><span
lang=EN-US>&nbsp;&nbsp;&nbsp; else-part</span></p>

<p class=AltD style='margin:0cm;margin-bottom:.0001pt;background:#fff'><span
lang=EN-US style='color:blue'>end</span><span lang=EN-US>;</span></p>

</div>

<p class=MsoNormal style='text-indent:21.0pt'><span lang=EN-US>while</span><span
style='font-family:宋体'>语句：</span></p>

<div style='border:RGB(191,154,43) dashed 1px;padding:1.0pt 4.0pt 1.0pt 4.0pt;
background:RGB(255,228,238);margin-left:21.0pt;margin-right:21.0pt'>

<p class=AltD style='margin:0cm;margin-bottom:.0001pt;background:#fff'><span
lang=EN-US style='color:blue'>while</span><span lang=EN-US> condition <span
style='color:blue'>do</span></span></p>

<p class=AltD style='margin:0cm;margin-bottom:.0001pt;background:RGB(251,233,229)'><span
lang=EN-US>&nbsp;&nbsp;&nbsp; statements;</span></p>

<p class=AltD style='margin:0cm;margin-bottom:.0001pt;background:#fff'><span
lang=EN-US style='color:blue'>end</span><span lang=EN-US>;</span></p>

</div>

<p class=MsoNormal style='text-indent:21.0pt'><span lang=EN-US>repeat-until</span><span
style='font-family:宋体'>语句：</span></p>

<div style='border:RGB(191,154,43) dashed 1px;padding:1.0pt 4.0pt 1.0pt 4.0pt;
background:RGB(225,223,224);margin-left:21.0pt;margin-right:21.0pt'>

<p class=AltD style='margin:0cm;margin-bottom:.0001pt;background:#fff'><span
lang=EN-US style='color:blue'>repeat</span></p>

<p class=AltD style='margin:0cm;margin-bottom:.0001pt;background:RGB(248,248,228)'><span
lang=EN-US>&nbsp;&nbsp;&nbsp; statements;</span></p>

<p class=AltD style='margin:0cm;margin-bottom:.0001pt;background:#fff'><span
lang=EN-US style='color:blue'>until</span><span lang=EN-US> conditions;</span></p>

</div>

<p class=MsoNormal style='text-indent:21.0pt'><span lang=EN-US>for</span><span
style='font-family:宋体'>语句有两大类：</span></p>

<p class=MsoNormal style='text-indent:21.0pt'><span style='font-family:宋体'>第一，数值</span><span
lang=EN-US>for</span><span style='font-family:宋体'>循环：</span></p>

<div style='border:RGB(191,154,43) dashed 1px;padding:1.0pt 4.0pt 1.0pt 4.0pt;
background:RGB(250,239,247);margin-left:21.0pt;margin-right:21.0pt'>

<p class=AltD style='margin:0cm;margin-bottom:.0001pt;background:#fff'><span
lang=EN-US style='color:blue'>for</span><span lang=EN-US> var=exp1,exp2,exp3 <span
style='color:blue'>do</span></span></p>

<p class=AltD style='margin:0cm;margin-bottom:.0001pt;background:RGB(248,243,247)'><span
lang=EN-US>&nbsp;&nbsp;&nbsp; loop-part</span></p>

<p class=AltD style='margin:0cm;margin-bottom:.0001pt;background:#fff'><span
lang=EN-US style='color:blue'>end</span></p>

</div>

<p class=MsoNormal style='text-indent:21.0pt'><span lang=EN-US>for</span><span
style='font-family:宋体'>将用</span><span lang=EN-US>exp3</span><span
style='font-family:宋体'>作为</span><span lang=EN-US>step</span><span
style='font-family:宋体'>从</span><span lang=EN-US>exp1</span><span
style='font-family:宋体'>（初始值）到</span><span lang=EN-US>exp2</span><span
style='font-family:宋体'>（终止值），执行</span><span lang=EN-US>loop-part</span><span
style='font-family:宋体'>。其中</span><span lang=EN-US>exp3</span><span
style='font-family:宋体'>可以省略，默认</span><span lang=EN-US>step=1</span></p>

<p class=MsoNormal style='text-indent:21.0pt'><span style='font-family:宋体'>有几点需要注意：</span></p>

<p class=MsoNormal style='text-indent:21.0pt'><span lang=EN-US>1. </span><span
style='font-family:宋体'>三个表达式只会被计算一次，并且是在循环开始前。</span></p>

<div style='border:RGB(191,154,43) dashed 1px;padding:1.0pt 4.0pt 1.0pt 4.0pt;
background:RGB(252,245,223);margin-left:21.0pt;margin-right:21.0pt'>

<p class=AltD style='margin:0cm;margin-bottom:.0001pt;background:#fff'><span
lang=EN-US style='color:blue'>for</span><span lang=EN-US> i=1,f(x) <span
style='color:blue'>do</span></span></p>

<p class=AltD style='margin:0cm;margin-bottom:.0001pt;background:RGB(225,241,237)'><span
lang=EN-US>&nbsp;&nbsp;&nbsp; print(i)</span></p>

<p class=AltD style='margin:0cm;margin-bottom:.0001pt;background:#fff'><span
lang=EN-US style='color:blue'>end</span></p>

<p class=AltD style='margin:0cm;margin-bottom:.0001pt;background:RGB(231,252,242)'><span
lang=EN-US>&nbsp;</span></p>

<p class=AltD style='margin:0cm;margin-bottom:.0001pt;background:#fff'><span
lang=EN-US style='color:blue'>for</span><span lang=EN-US> i=10,1,-1 <span
style='color:blue'>do</span></span></p>

<p class=AltD style='margin:0cm;margin-bottom:.0001pt;background:RGB(222,251,248)'><span
lang=EN-US>&nbsp;&nbsp;&nbsp; print(i)</span></p>

<p class=AltD style='margin:0cm;margin-bottom:.0001pt;background:#fff'><span
lang=EN-US style='color:blue'>end</span></p>

</div>

<p class=MsoNormal style='text-indent:21.0pt'><span style='font-family:宋体'>第一个例子</span><span
lang=EN-US>f(x)</span><span style='font-family:宋体'>只会在循环前被调用一次。</span></p>

<p class=MsoNormal style='text-indent:21.0pt'><span lang=EN-US>2. </span><span
style='font-family:宋体'>控制变量</span><span lang=EN-US>var</span><span
style='font-family:宋体'>是局部变量自动被声明</span><span lang=EN-US>,</span><span
style='font-family:宋体'>并且只在循环内有效</span><span lang=EN-US>.</span></p>

<div style='border:RGB(191,154,43) dashed 1px;padding:1.0pt 4.0pt 1.0pt 4.0pt;
background:RGB(233,253,252);margin-left:21.0pt;margin-right:21.0pt'>

<p class=AltD style='margin:0cm;margin-bottom:.0001pt;background:#fff'><span
lang=EN-US style='color:blue'>for</span><span lang=EN-US> i=1,10 <span
style='color:blue'>do</span></span></p>

<p class=AltD style='margin:0cm;margin-bottom:.0001pt;background:RGB(255,243,220)'><span
lang=EN-US>&nbsp;&nbsp;&nbsp; print(i)</span></p>

<p class=AltD style='margin:0cm;margin-bottom:.0001pt;background:#fff'><span
lang=EN-US style='color:blue'>end</span></p>

<p class=AltD style='margin:0cm;margin-bottom:.0001pt;background:RGB(253,228,250)'><span
lang=EN-US>max = i&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style='color:green'>--
probably wrong! 'i' here is global</span></span></p>

</div>

<p class=MsoNormal style='text-indent:21.0pt'><span style='font-family:宋体'>如果需要保留控制变量的值，需要在循环中将其保存</span></p>

<div style='border:RGB(191,154,43) dashed 1px;padding:1.0pt 4.0pt 1.0pt 4.0pt;
background:#fff;margin-left:21.0pt;margin-right:21.0pt'>

<p class=AltD style='margin:0cm;margin-bottom:.0001pt;background:RGB(250,224,247)'><span
lang=EN-US style='color:green'>-- find a value in a list</span></p>

<p class=AltD style='margin:0cm;margin-bottom:.0001pt;background:#fff'><span
lang=EN-US style='color:blue'>local</span><span lang=EN-US> found = <span
style='color:blue'>nil</span></span></p>

<p class=AltD style='margin:0cm;margin-bottom:.0001pt;background:RGB(248,232,220)'><span
lang=EN-US style='color:blue'>for</span><span lang=EN-US> i=1,a.n <span
style='color:blue'>do</span></span></p>

<p class=AltD style='margin:0cm;margin-bottom:.0001pt;background:#fff'><span
lang=EN-US>&nbsp;&nbsp;&nbsp; <span style='color:blue'>if</span> a[i] == value <span
style='color:blue'>then</span></span></p>

<p class=AltD style='margin:0cm;margin-bottom:.0001pt;background:RGB(228,248,220)'><span
lang=EN-US>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; found = i&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span
style='color:green'>-- save value of 'i'</span></span></p>

<p class=AltD style='margin:0cm;margin-bottom:.0001pt;background:#fff'><span
lang=EN-US>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span style='color:blue'>break</span></span></p>

<p class=AltD style='margin:0cm;margin-bottom:.0001pt;background:RGB(246,253,246)'><span
lang=EN-US>&nbsp;&nbsp;&nbsp; <span style='color:blue'>end</span></span></p>

<p class=AltD style='margin:0cm;margin-bottom:.0001pt;background:#fff'><span
lang=EN-US style='color:blue'>end</span></p>

<p class=AltD style='margin:0cm;margin-bottom:.0001pt;background:RGB(248,251,240)'><span
lang=EN-US>print(found)</span></p>

</div>

<p class=MsoNormal style='text-indent:21.0pt'><span lang=EN-US>3. </span><span
style='font-family:宋体'>循环过程中不要改变控制变量的值，那样做的结果是不可预知的。如果要退出循环，使用</span><span
lang=EN-US>break</span><span style='font-family:宋体'>语句。</span></p>

<p class=MsoNormal style='text-indent:21.0pt'><span lang=EN-US>&nbsp;</span></p>

<p class=MsoNormal style='text-indent:21.0pt'><span style='font-family:宋体'>第二，范型</span><span
lang=EN-US>for</span><span style='font-family:宋体'>循环：</span></p>

<p class=MsoNormal style='text-indent:21.0pt'><span style='font-family:宋体'>前面已经见过一个例子：</span></p>

<div style='border:RGB(191,154,43) dashed 1px;padding:1.0pt 4.0pt 1.0pt 4.0pt;
background:#fff;margin-left:21.0pt;margin-right:21.0pt'>

<p class=AltD style='margin:0cm;margin-bottom:.0001pt;background:RGB(254,226,238)'><span
lang=EN-US style='color:green'>-- print all values of array 'a' </span></p>

<p class=AltD style='margin:0cm;margin-bottom:.0001pt;background:#fff'><span
lang=EN-US style='color:blue'>for</span><span lang=EN-US> i,v <span
style='color:blue'>in</span> ipairs(a) <span style='color:blue'>do</span>
print(v) <span style='color:blue'>end</span></span></p>

</div>

<p class=MsoNormal style='text-indent:21.0pt'><span style='font-family:宋体'>范型</span><span
lang=EN-US>for</span><span style='font-family:宋体'>遍历迭代子函数返回的每一个值。</span></p>

<p class=MsoNormal style='text-indent:21.0pt'><span style='font-family:宋体'>再看一个遍历表</span><span
lang=EN-US>key</span><span style='font-family:宋体'>的例子：</span></p>

<div style='border:RGB(191,154,43) dashed 1px;padding:1.0pt 4.0pt 1.0pt 4.0pt;
background:RGB(231,230,224);margin-left:21.0pt;margin-right:21.0pt'>

<p class=AltD style='margin:0cm;margin-bottom:.0001pt;background:#fff'><span
lang=EN-US style='color:green'>-- print all keys of table 't'</span></p>

<p class=AltD style='margin:0cm;margin-bottom:.0001pt;background:RGB(228,253,223)'><span
lang=EN-US style='color:blue'>for</span><span lang=EN-US> k <span
style='color:blue'>in</span> pairs(t) <span style='color:blue'>do</span>
print(k) <span style='color:blue'>end</span></span></p>

</div>

<p class=MsoNormal style='text-indent:21.0pt'><span style='font-family:宋体'>范型</span><span
lang=EN-US>for</span><span style='font-family:宋体'>和数值</span><span lang=EN-US>for</span><span
style='font-family:宋体'>有两点相同：</span></p>

<p class=MsoNormal style='text-indent:21.0pt'><span lang=EN-US>1. </span><span
style='font-family:宋体'>控制变量是局部变量</span></p>

<p class=MsoNormal style='text-indent:21.0pt'><span lang=EN-US>2. </span><span
style='font-family:宋体'>不要修改控制变量的值</span></p>

<p class=MsoNormal style='text-indent:21.0pt'><span style='font-family:宋体'>再看一个例子，假定有一个表：</span></p>

<div style='border:RGB(191,154,43) dashed 1px;padding:1.0pt 4.0pt 1.0pt 4.0pt;
background:#fff;margin-left:21.0pt;margin-right:21.0pt'>

<p class=AltD style='margin:0cm;margin-bottom:.0001pt;background:RGB(222,226,242)'><span
lang=EN-US>days = {<span style='color:red'>&quot;Sunday&quot;</span>, <span
style='color:red'>&quot;Monday&quot;</span>, <span style='color:red'>&quot;Tuesday&quot;</span>,
<span style='color:red'>&quot;Wednesday&quot;</span>,</span></p>

<p class=AltD style='margin:0cm;margin-bottom:.0001pt;background:#fff'><span
lang=EN-US>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span
style='color:red'>&quot;Thursday&quot;</span>, <span style='color:red'>&quot;Friday&quot;</span>,
<span style='color:red'>&quot;Saturday&quot;</span>}</span></p>

</div>

<p class=MsoNormal style='text-indent:21.0pt'><span style='font-family:宋体'>现在想把对应的名字转换成星期几，一个有效地解决问题的方式是构造一个反向表：</span></p>

<p class=MsoNormal style='text-indent:21.0pt'><span lang=EN-US>revDays = {[<span
style='color:red'>&quot;Sunday&quot;</span>] = 1, [<span style='color:red'>&quot;Monday&quot;</span>]
= 2, </span></p>

<p class=MsoNormal style='text-indent:21.0pt'><span lang=EN-US>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; [<span
style='color:red'>&quot;Tuesday&quot;</span>] = 3, [<span style='color:red'>&quot;Wednesday&quot;</span>]
= 4,</span></p>

<p class=MsoNormal style='text-indent:21.0pt'><span lang=EN-US>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; [<span
style='color:red'>&quot;Thursday&quot;</span>] = 5, [<span style='color:red'>&quot;Friday&quot;</span>]
= 6,&nbsp; </span></p>

<p class=MsoNormal style='text-indent:21.0pt'><span lang=EN-US>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; [<span
style='color:red'>&quot;Saturday&quot;</span>] = 7} </span></p>

<p class=MsoNormal style='text-indent:21.0pt'><span style='font-family:宋体'>下面就可以很容易获取问题的答案了</span><span
lang=EN-US>:</span></p>

<div style='border:RGB(191,154,43) dashed 1px;padding:1.0pt 4.0pt 1.0pt 4.0pt;
background:RGB(226,221,251);margin-left:21.0pt;margin-right:21.0pt'>

<p class=AltD style='margin:0cm;margin-bottom:.0001pt;background:#fff'><span
lang=EN-US>x = <span style='color:red'>&quot;Tuesday&quot;</span> </span></p>

<p class=AltD style='margin:0cm;margin-bottom:.0001pt;background:RGB(223,252,237)'><span
lang=EN-US>print(revDays[x])&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span
style='color:green'>--&gt; 3</span></span></p>

</div>

<p class=MsoNormal style='text-indent:21.0pt'><span style='font-family:宋体'>我们不需要手工，可以自动构造反向表</span></p>

<div style='border:RGB(191,154,43) dashed 1px;padding:1.0pt 4.0pt 1.0pt 4.0pt;
background:#fff;margin-left:21.0pt;margin-right:21.0pt'>

<p class=AltD style='margin:0cm;margin-bottom:.0001pt;background:RGB(237,241,225)'><span
lang=EN-US>revDays = {} </span></p>

<p class=AltD style='margin:0cm;margin-bottom:.0001pt;background:#fff'><span
lang=EN-US style='color:blue'>for</span><span lang=EN-US> i,v <span
style='color:blue'>in</span> ipairs(days) <span style='color:blue'>do</span></span></p>

<p class=AltD style='margin:0cm;margin-bottom:.0001pt;background:RGB(232,240,249)'><span
lang=EN-US>&nbsp;&nbsp;&nbsp; revDays[v] = i </span></p>

<p class=AltD style='margin:0cm;margin-bottom:.0001pt;background:#fff'><span
lang=EN-US style='color:blue'>end </span></p>

</div>

<p class=MsoNormal style='text-indent:21.0pt'><span style='font-family:宋体'>如果你对范型</span><span
lang=EN-US>for</span><span style='font-family:宋体'>还有些不清楚在后面的章节我们会继续来学习。</span></p>


</div>
  <p></p>
  <hr class="moHR" />
  <span class="moCopyright">
    相关链接：
<br /><a href="_3.htm">lua程序设计目录</a> - <a href="http://www.luaer.cn">中国lua开发者</a> - <a href="http://bbs.luaer.cn">lua论坛</a> 
  </span><div id="bookfoot"></div>
<script language="JavaScript" src="js/ad.js"></script>
</body>

</html>

